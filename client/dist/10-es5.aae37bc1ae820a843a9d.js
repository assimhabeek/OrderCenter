!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{AZnH:function(t,a,n){"use strict";n.r(a),n.d(a,"ExportModule",function(){return N});var o=n("tyNb"),i=n("3Pt+"),s=n("Iab2"),c=n("r4zg"),l=n("vkgz"),u=n("GGDx"),d=n("fXoL"),f=n("MOE4"),p=n("0IaG"),h=n("u47x"),m=n("A9p3"),b=n("3LUQ"),g=n("Wp6s"),v=n("kmnG"),y=n("iadO"),k=n("ofXK"),w=n("d3UM"),D=n("FKr1"),x=n("bTqV"),C=n("NFeN"),E=n("cWTo");function R(e,t){1&e&&(d.Rb(0,"mat-error"),d.xc(1," You must select a valid range. "),d.Qb())}function S(e,t){1&e&&(d.Rb(0,"mat-error"),d.xc(1," You must select a type. "),d.Qb())}function O(e,t){if(1&e&&(d.Rb(0,"div",15),d.Mb(1,"ag-grid-angular",16),d.Qb()),2&e){var r=d.cc();d.Ab(1),d.hc("gridOptions",r.options)("modules",r.modules)("rowData",r.rowData)}}var M,A,P=((M=function(){function t(r,a,n,o,s){var l=this;e(this,t),this.ordersService=r,this.dialog=a,this._focusMonitor=n,this.confirmService=o,this.alertService=s,this.orderStatus=2,this.rowData=[],this.modules=[],this.currentFileParams={},this.orderDateRange=new i.f({startDate:new i.d(c.a.now(),i.s.required),endDate:new i.d(c.a.now(),i.s.required),type:new i.d("carifix",i.s.required)}),this.loadHeaders().subscribe(function(e){l.setupOptions()},function(e){console.log(e),l.onError("Could not load grid info")})}return r(t,[{key:"exportOrders",value:function(){var e,t=this;e=[],this.gridApi.forEachNode(function(t){e.push(t.data)}),0!==e.length?(this.currentFileParams.data=e,this.confirmService.requestConfirmation("Export Confirmation","All the visible orders will be achieved automatically, Would you like to proceed ?").subscribe(function(e){e&&t.ordersService.exportOrders(t.currentFileParams).subscribe(function(e){t.saveAsExcelFile(e.body,e.headers.get("x-file-name")||""),t.refresh()})})):this.onError("Nothing to export")}},{key:"ordersLinkedToFiles",value:function(e){return e.some(function(e){return null!=e.EXPORT_FILE})}},{key:"getFormattedDates",value:function(){var e=this.orderDateRange.value,t=e.startDate,r=e.endDate;return t.startOf("day"),r.endOf("day"),{formattedStart:c.a.formatDate(t),formattedEnd:c.a.formatDate(r)}}},{key:"saveAsExcelFile",value:function(e,t){var r=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});s.saveAs(r,t)}},{key:"onGridReady",value:function(e){this.gridApi=e.api,this.gridColumnApi=e.columnApi,this.listenToOrderDateForm(),this.refresh()}},{key:"listenToOrderDateForm",value:function(){var e=this;this.orderDateRange.valid&&this.orderDateRange.valueChanges.subscribe(function(t){e.refresh()})}},{key:"loadHeaders",value:function(){var e=this;return this.ordersService.getHeader().pipe(Object(l.a)(function(t){e.columns=t}))}},{key:"setupOptions",value:function(){this.options={pagination:!1,tooltipShowDelay:0,defaultColDef:{sortable:!0,filter:!1,tooltipComponent:"tooltipRenderer",filterParams:{filterOptions:["contains"],defaultOption:"contains",suppressAndOrCondition:!0},resizable:!0,editable:!1},animateRows:!0,rowSelection:"single",columnDefs:this.columns,onGridReady:this.onGridReady.bind(this),paginationAutoPageSize:!1,frameworkComponents:{tooltipRenderer:u.a}}}},{key:"refresh",value:function(){var e=this;if(this.orderDateRange.valid){var t=this.getFormattedDates();this.ordersService.loadOrdersByRange(t.formattedStart,t.formattedEnd,this.orderDateRange.value.type).subscribe(function(r){r.status?(e.rowData=r.data,e.currentFileParams={startDate:t.formattedStart,endDate:t.formattedEnd,type:e.orderDateRange.value.type}):e.onError("Couldn't load the data")},function(t){e.onError(t.message)})}}},{key:"onSuccess",value:function(e){this.alertService.alertSuccess(e)}},{key:"onError",value:function(e){this.alertService.alertError(e)}},{key:"clearFilters",value:function(){this.orderDateRange.reset({orderDate:null}),this.gridApi.setFilterModel({}),this.refresh()}}]),t}()).\u0275fac=function(e){return new(e||M)(d.Lb(f.a),d.Lb(p.b),d.Lb(h.h),d.Lb(m.a),d.Lb(b.a))},M.\u0275cmp=d.Fb({type:M,selectors:[["ct-export"]],decls:25,vars:6,consts:[[1,"ct-toolbar","mat-elevation-z1"],[3,"formGroup"],[1,"ct-order-date"],[3,"rangePicker"],["matStartDate","","formControlName","startDate","placeholder","Start date"],["matEndDate","","formControlName","endDate","placeholder","End date"],["matSuffix","",3,"for"],["datePicker",""],[4,"ngIf"],[1,"ct-order-type"],["formControlName","type"],["value","carifix"],["value","non-carifix"],["mat-icon-button","","type","button","color","primary",3,"click"],["class","ct-table-wrapper",4,"ngIf"],[1,"ct-table-wrapper"],[1,"ag-theme-balham",3,"gridOptions","modules","rowData"]],template:function(e,t){if(1&e&&(d.Rb(0,"mat-card",0),d.Rb(1,"div",1),d.Rb(2,"mat-form-field",2),d.Rb(3,"mat-label"),d.xc(4,"Enter a date range"),d.Qb(),d.Rb(5,"mat-date-range-input",3),d.Mb(6,"input",4),d.Mb(7,"input",5),d.Qb(),d.Mb(8,"mat-datepicker-toggle",6),d.Mb(9,"mat-date-range-picker",null,7),d.wc(11,R,2,0,"mat-error",8),d.Qb(),d.Rb(12,"mat-form-field",9),d.Rb(13,"mat-label"),d.xc(14,"Select orders type"),d.Qb(),d.Rb(15,"mat-select",10),d.Rb(16,"mat-option",11),d.xc(17,"CariFix"),d.Qb(),d.Rb(18,"mat-option",12),d.xc(19,"Non CariFix"),d.Qb(),d.Qb(),d.wc(20,S,2,0,"mat-error",8),d.Qb(),d.Rb(21,"button",13),d.Yb("click",function(){return t.exportOrders()}),d.Rb(22,"mat-icon"),d.xc(23,"get_app"),d.Qb(),d.Qb(),d.Qb(),d.Qb(),d.wc(24,O,2,3,"div",14)),2&e){var r=d.mc(10);d.Ab(1),d.hc("formGroup",t.orderDateRange),d.Ab(4),d.hc("rangePicker",r),d.Ab(3),d.hc("for",r),d.Ab(3),d.hc("ngIf",t.orderDateRange.controls.startDate.hasError("required")||t.orderDateRange.controls.endDate.hasError("required")),d.Ab(9),d.hc("ngIf",t.orderDateRange.controls.type.hasError("required")),d.Ab(4),d.hc("ngIf",t.columns)}},directives:[g.a,i.m,i.g,v.c,v.f,y.a,y.h,i.c,i.l,i.e,y.g,y.f,v.h,y.b,k.k,w.a,D.k,x.a,C.a,v.b,E.a],styles:[".ct-toolbar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;padding:0!important;margin:0!important}.ct-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.ct-table-wrapper[_ngcontent-%COMP%]{width:100%;display:flex;position:relative}.ct-table-wrapper[_ngcontent-%COMP%]   ag-grid-angular[_ngcontent-%COMP%]{display:inline-block;flex:1 1 auto;height:calc(100vh - 148px)}button[_ngcontent-%COMP%]{height:36px!important}button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px!important}.ct-order-date[_ngcontent-%COMP%]{height:36px;font-size:12px}mat-form-field[_ngcontent-%COMP%]{margin:4px}"]}),M),F=n("PCNd"),_=n("vvyD"),N=((A=function t(){e(this,t)}).\u0275mod=d.Jb({type:A}),A.\u0275inj=d.Ib({factory:function(e){return new(e||A)},imports:[[k.c,F.a,E.b.withComponents(),_.a,i.h,i.q,o.e.forChild([{path:"",component:P,pathMatch:"full"}])]]}),A)},GGDx:function(t,a,n){"use strict";n.d(a,"a",function(){return s});var o=n("r4zg"),i=n("fXoL"),s=function(){var t=function(){function t(){e(this,t)}return r(t,[{key:"agInit",value:function(e){this.data=e.api.getDisplayedRowAtIndex(e.rowIndex).data}},{key:"parseDate",value:function(){return o.a.fromMysqlDateTime(this.data.lastModification).format("YYYY-MM-DD HH:mm:ss")}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Fb({type:t,selectors:[["tooltip-component"]],decls:3,vars:1,consts:[[1,"tooltip"]],template:function(e,t){1&e&&(i.Rb(0,"div",0),i.Rb(1,"p"),i.xc(2),i.Qb(),i.Qb()),2&e&&(i.Ab(2),i.zc(" ",t.parseDate()," "))},styles:["[_nghost-%COMP%] {\n                position: absolute;\n                width: 150px;\n                height: 70px;\n                pointer-events: none;\n                transition: opacity 1s;\n            }\n\n            .ag-tooltip-hiding[_nghost-%COMP%] {\n                opacity: 0;\n            }\n\n            .tooltip[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\n                margin: 5px;\n                padding: 8px;\n                background: rgba(0, 0, 0, 0.9);\n                color: #eeeeee;\n                white-space: nowrap;\n            }"]}),t}()},PAny:function(t,a,n){"use strict";n.d(a,"a",function(){return f});var o=n("AytR"),i=n("tk/3"),s=n("lJxs"),c=n("r4zg"),l=n("fXoL"),u=n("N+K7"),d=n("As+J"),f=function(){var t=function(){function t(r,a){e(this,t),this.httpService=r,this.skusService=a}return r(t,[{key:"getSKUs",value:function(){var e=this;return this.skusService.getSkus().pipe(Object(s.a)(function(t){var r=t.data.reduce(function(e,t){var r=e[t.skuType]||[];return r.push(t),e[t.skuType]=r,e},{});return Object.keys(r).reduce(function(t,a){return t[a]=e.addEmptyAndCompletedToSkus(r[a]),t},{})}))}},{key:"getHeader",value:function(){var e=this;return this.getSKUs().pipe(Object(s.a)(function(t){var r=t.HIGH_BEAM||e.addEmptyAndCompletedToSkus([]),a=t.LOW_BEAM||e.addEmptyAndCompletedToSkus([]),n=t.FOG_LIGHT||e.addEmptyAndCompletedToSkus([]);return e.buildHeader(r,a,n)}))}},{key:"addEmptyAndCompletedToSkus",value:function(e){return e&&((e=e.map(function(e){return e.name})).unshift(c.a.NOT_EMPTY_CHAR),e.unshift("")),e||[]}},{key:"buildHeader",value:function(e,t,r){return console.log(e),[{field:"year",headerName:"Vehicle Year"},{field:"make",headerName:"Vehicle Make"},{field:"model",headerName:"Vehicle Model"},{field:"highLowBeam",headerName:"High and LOW beam",cellEditor:"selectEditor",cellEditorParams:{elements:e.filter(function(e){return t.includes(e)})}},{field:"highBeam",headerName:"High beam",cellEditor:"selectEditor",cellEditorParams:{elements:e}},{field:"lowBeam",headerName:"Low beam",cellEditor:"selectEditor",cellEditorParams:{elements:t}},{field:"fogLight",headerName:"Fog light",cellEditor:"selectEditor",cellEditorParams:{elements:r}}]}},{key:"getRows",value:function(e){var t=Object.keys(e.request.filterModel).map(function(t){return{name:t,value:e.request.filterModel[t].filter}}),r=JSON.stringify(t),a=(new i.c).set("start",e.request.startRow.toString()).set("end",e.request.endRow.toString()).set("filter",r).set("sortBy",e.request.sortModel[0]?e.request.sortModel[0].colId:"").set("sortDirection",e.request.sortModel[0]?e.request.sortModel[0].sort:"");this.httpService.getWithAuth(o.a.routes.vehicles,{params:a}).subscribe(function(t){if(t.status){e.successCallback(t.data,t.total);var r=[];e.columnApi.getAllColumns().forEach(function(e){r.push(e.colId)}),e.columnApi.autoSizeColumns(r,!1)}else e.failCallback()},function(t){e.failCallback()})}},{key:"addRow",value:function(e){return this.httpService.postWithAuth(o.a.routes.vehicles,e)}},{key:"updateCell",value:function(e){return this.httpService.putWithAuth(o.a.routes.vehicles,e).toPromise()}},{key:"deleteRow",value:function(e){return this.httpService.deleteWithAuth(o.a.routes.vehicles+"/"+e)}},{key:"getYear",value:function(){return this.httpService.get(o.a.routes.year)}},{key:"getMake",value:function(e){return this.httpService.get(o.a.routes.make,{params:(new i.c).set("year",e)}).toPromise()}},{key:"getModel",value:function(e,t){return this.httpService.get(o.a.routes.model,{params:(new i.c).set("year",e).set("make",t)}).toPromise()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(l.Vb(u.a),l.Vb(d.a))},t.\u0275prov=l.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()}}])}();